import{i as m,r as i,p as V,u as Y,q as F,w as Q,k as W,o as X,a as Z,j as e,M as $,c as ee,C as B}from"./index-lpKxc9Tz.js";import{u as te}from"./useNotifications-em8gr2Mf.js";import{C as se}from"./chevron-left-K_2-wExl.js";import{C as ae}from"./camera-De_BjzON.js";import{C as le}from"./check-CCKgXOsx.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],ie=m("bell-off",ne);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],R=m("bell",re);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],q=m("check-check",ce);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],de=m("clock",oe);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],me=m("ellipsis-vertical",xe);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],ue=m("mic",he);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],pe=m("paperclip",fe);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ge=m("send",ye);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M22 2 2 22",key:"y4kqgn"}]],ve=m("slash",be),$e=({user:r,currentLang:d})=>{const[n,M]=i.useState(null),[S,g]=i.useState([]),[w,z]=i.useState(""),[h,I]=i.useState([]),[b,T]=i.useState([]),[_,k]=i.useState(!1),[v,A]=i.useState(!1),[C,D]=i.useState(!1),[y,P]=i.useState([]),[U,E]=i.useState(!0),{notify:O}=te(),j=V.useRef(null),{primaryColor:u,textColor:f}=Y(),c=Z[d];i.useEffect(()=>{E(!0);const t=F(W(ee,"users"),Q("role","==","driver")),l=X(t,a=>{const o=[];a.forEach(s=>{s.id!==r.id&&o.push({id:s.id,...s.data()})}),P(o),E(!1)});return()=>l()},[r.id]);const H=()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)};i.useEffect(()=>{H()},[S,n,v]),i.useEffect(()=>{const t=setInterval(()=>{g(l=>l.map(a=>{if(a.senderId===r.id&&a.status!=="read"){if(a.status==="sending")return{...a,status:"sent"};if(a.status==="sent")return{...a,status:"delivered"};if(a.status==="delivered"&&Date.now()-a.timestamp>3e3)return{...a,status:"read"}}return a}))},2e3);return()=>clearInterval(t)},[r.id]),i.useEffect(()=>{if(!n||h.includes(n))return;const t=setInterval(()=>{if(Math.random()>.8){const l=y[Math.floor(Math.random()*y.length)],a=l.id;n===a&&A(!0),setTimeout(()=>{n===a&&A(!1);const o=d==="ar"?["أنا في طريقي","هل الموقع صحيح؟","دقيقة من فضلك","موافق"]:d==="fr"?["J'arrive","C'est noté","Envoyez la position","Ok"]:["I'm coming","Noted","Send location","Ok"],s=o[Math.floor(Math.random()*o.length)],N={id:Date.now().toString(),senderId:a,receiverId:r.id,text:s,timestamp:Date.now(),status:"read",type:"text"};g(x=>[...x,N]),n!==a&&O(c.newMessageTitle,{body:`${l.name}: ${s}`})},2500)}},8e3);return()=>clearInterval(t)},[n,h,r.id,d,O,y]);const p=(t=w,l="text",a)=>{if(!t.trim()&&l==="text"||!n)return;const o={id:Date.now().toString(),senderId:r.id,receiverId:n,text:t,timestamp:Date.now(),status:"sending",type:l,locationData:a};g(s=>[...s,o]),l==="text"&&z(""),D(!1),h.includes(n)||setTimeout(()=>{const s=d==="ar"?"وصلت الرسالة":d==="fr"?"Reçu":"Received",N={id:(Date.now()+1).toString(),senderId:n,receiverId:r.id,text:s,timestamp:Date.now(),status:"read",type:"text"};g(x=>[...x,N])},2e3)},L=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const{latitude:l,longitude:a}=t.coords;p("Current Location","location",{lat:l,lng:a})},t=>{console.error("Geolocation error:",t),p("Constantine (Mock)","location",B)}):p("Constantine (Mock)","location",B)},K=t=>{h.includes(t)?I(h.filter(l=>l!==t)):I([...h,t]),k(!1)},G=t=>{b.includes(t)?T(b.filter(l=>l!==t)):T([...b,t]),k(!1)},J=t=>t==="sending"?e.jsx(de,{size:12,className:"text-gray-400"}):t==="sent"?e.jsx(le,{size:12,className:"text-gray-400"}):t==="delivered"?e.jsx(q,{size:12,className:"text-gray-400"}):t==="read"?e.jsx(q,{size:12,className:"text-blue-500"}):null;if(n){const t=y.find(s=>s.id===n);if(!t)return null;const l=S.filter(s=>s.senderId===r.id&&s.receiverId===n||s.senderId===n&&s.receiverId===r.id),a=h.includes(n),o=b.includes(n);return e.jsxs("div",{className:`flex flex-col h-[calc(100vh-140px)] bg-${f}-50 ${d==="ar"?"rtl":""}`,children:[e.jsxs("div",{className:"bg-white p-3 shadow-sm flex justify-between items-center z-20",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>M(null),className:"mr-2",children:e.jsx(se,{size:24,className:`text-${f}-600 ${d==="ar"?"rotate-180":""}`})}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative mr-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-${u}-100 flex items-center justify-center text-${u}-600 font-bold`,children:t.companyName.substring(0,1)}),t.isAvailable&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold text-sm text-${f}-800`,children:t.companyName}),e.jsx("span",{className:`text-[10px] ${v?"text-green-600 font-bold animate-pulse":"text-gray-400"}`,children:v?c.typing:t.isAvailable?c.online:c.offlineStatus})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>k(!_),className:`p-2 rounded-full hover:bg-gray-100 text-${f}-500`,children:e.jsx(me,{size:20})}),_&&e.jsxs("div",{className:`absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden z-50 ${d==="ar"?"left-0 right-auto":""}`,children:[e.jsxs("button",{onClick:()=>G(n),className:"w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center space-x-2 text-sm",children:[o?e.jsx(R,{size:16}):e.jsx(ie,{size:16}),e.jsx("span",{children:o?c.unmuteChat:c.muteChat})]}),e.jsxs("button",{onClick:()=>K(n),className:"w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center space-x-2 text-sm text-red-600",children:[e.jsx(ve,{size:16}),e.jsx("span",{children:a?c.unblockUser:c.blockUser})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",ref:j,children:[e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"bg-gray-200 text-gray-600 text-[10px] px-3 py-1 rounded-full",children:c.today||"Today"})}),l.map((s,N)=>{const x=s.senderId===r.id;return e.jsx("div",{className:`flex ${x?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[75%] group relative ${x?"items-end":"items-start"} flex flex-col`,children:e.jsxs("div",{className:`p-3 rounded-2xl text-sm shadow-sm relative ${x?`bg-${u}-600 text-white rounded-br-none`:"bg-white text-gray-800 rounded-bl-none"}`,children:[s.type==="location"?e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{size:16}),e.jsx("span",{className:"font-bold underline",children:"Location Shared"})]}),e.jsx("div",{className:"w-32 h-20 bg-gray-200 rounded overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-300",children:e.jsx($,{size:12,className:"text-gray-500"})})})]}):s.text,e.jsxs("div",{className:`text-[9px] mt-1 flex items-center justify-end space-x-1 ${x?"text-white/70":"text-gray-400"}`,children:[e.jsx("span",{children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),x&&J(s.status)]})]})})},s.id)}),v&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl rounded-bl-none shadow-sm flex space-x-1 items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})}),a&&e.jsx("div",{className:"text-center text-xs text-red-500 bg-red-50 py-2 rounded mt-4",children:"You have blocked this user."})]}),!a&&e.jsxs("div",{className:"bg-white p-2 border-t border-gray-100 pb-[env(safe-area-inset-bottom)] z-20",children:[C&&e.jsxs("div",{className:"flex space-x-4 p-3 bg-gray-50 rounded-lg mb-2 mx-2 animate-fade-in-up",children:[e.jsxs("button",{onClick:L,className:"flex flex-col items-center space-y-1 text-gray-600 hover:text-green-600",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full text-green-600",children:e.jsx($,{size:20})}),e.jsx("span",{className:"text-[10px]",children:"Location"})]}),e.jsxs("button",{className:"flex flex-col items-center space-y-1 text-gray-600 hover:text-blue-600",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full text-blue-600",children:e.jsx(ae,{size:20})}),e.jsx("span",{className:"text-[10px]",children:"Camera"})]})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("button",{onClick:()=>D(!C),className:`p-3 rounded-full hover:bg-gray-100 text-gray-500 transition-colors ${C?"bg-gray-200":""}`,children:e.jsx(pe,{size:20})}),e.jsx("div",{className:"flex-1 bg-gray-100 rounded-2xl px-4 py-2 flex items-center",children:e.jsx("textarea",{value:w,onChange:s=>z(s.target.value),placeholder:c.typeMessage,className:"w-full bg-transparent outline-none text-sm resize-none max-h-24 py-1",rows:1,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),p())}})}),w.trim()?e.jsx("button",{onClick:()=>p(),className:`bg-${u}-600 text-white p-3 rounded-full hover:bg-${u}-700 shadow-md transition-all transform hover:scale-105 active:scale-95`,children:e.jsx(ge,{size:18})}):e.jsx("button",{className:"bg-gray-200 text-gray-500 p-3 rounded-full hover:bg-gray-300",children:e.jsx(ue,{size:18})})]}),e.jsx("div",{className:"flex space-x-2 mt-2 overflow-x-auto pb-1 px-1 scrollbar-hide",children:["I'm arriving","Send location","Ok","Call me"].map(s=>e.jsx("button",{onClick:()=>p(s),className:"whitespace-nowrap px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs hover:bg-gray-200 border border-gray-200",children:s},s))})]})]})}return e.jsxs("div",{className:`p-4 pb-20 ${d==="ar"?"rtl":""}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:`font-bold text-lg text-${f}-800`,children:c.contacts}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{className:"p-2 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200",children:e.jsx(R,{size:18})})})]}),U?e.jsx("div",{className:"text-center text-sm text-gray-500 py-8",children:"Loading contacts..."}):e.jsx("div",{className:"space-y-3",children:y.map(t=>{const l=h.includes(t.id);return e.jsxs("button",{onClick:()=>M(t.id),className:`w-full bg-white p-4 rounded-xl shadow-sm border border-${f}-100 flex items-center justify-between hover:bg-gray-50 transition-colors ${l?"opacity-50 grayscale":""}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 overflow-hidden",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:`w-12 h-12 bg-${u}-100 rounded-full flex items-center justify-center text-${u}-600 font-bold text-lg`,children:t.companyName.substring(0,1)}),t.isAvailable&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"text-left min-w-0",children:[e.jsx("div",{className:"flex justify-between items-center w-full",children:e.jsx("h4",{className:`font-bold text-sm text-${f}-800 truncate pr-2`,children:t.companyName})}),e.jsx("p",{className:`text-xs text-${f}-500 truncate`,children:l?"(Blocked)":"Hey, are you available?"})]})]}),e.jsxs("div",{className:"flex flex-col items-end pl-2",children:[e.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap mb-1",children:"10:30 AM"}),t.id==="o2"&&e.jsx("span",{className:`w-5 h-5 bg-${u}-600 text-white text-[10px] rounded-full flex items-center justify-center`,children:"2"})]})]},t.id)})})]})};export{$e as default};
