import{i as v,r as l,j as e,u as R,C as G,q as B,k as E,o as F,R as N,d as L,c as w,l as z,a as H,m as U,G as V,n as Y,g as J}from"./index-Dwgq_cU1.js";import{u as K}from"./useNotifications-DREHt3Pt.js";import{T as Q}from"./triangle-alert-DvbEXuzs.js";import{P as W}from"./phone-BT7q1qtm.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Z=v("layers",X);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],se=v("loader",ee);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],ae=v("navigation",te),ne=({userLocation:i,trucks:d,onTruckClick:a,isLoading:f,primaryColor:n,mapStyle:o,onMapStyleChange:t})=>{const c=l.useRef(null),[m,g]=l.useState(!1);return l.useEffect(()=>{if(window.google)g(!0);else{const r=document.createElement("script");r.src="https://maps.googleapis.com/maps/api/js?key=undefined",r.async=!0,r.onload=()=>g(!0),document.head.appendChild(r)}},[]),l.useEffect(()=>{if(m&&c.current){const r=new window.google.maps.Map(c.current,{center:i,zoom:12,disableDefaultUI:!0,styles:o==="roads"?[{featureType:"road",stylers:[{visibility:"on"}]}]:[]});new window.google.maps.Marker({position:i,map:r,title:"You are here"}),d.forEach(u=>{const x={lat:u.location.latitude,lng:u.location.longitude};new window.google.maps.Marker({position:x,map:r,title:u.companyName,icon:{url:u.isAvailable?"http://maps.google.com/mapfiles/ms/icons/green-dot.png":"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}}).addListener("click",()=>a(u))})}},[m,i,d,a,o,n]),f||!m?e.jsxs("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg",children:[e.jsx(se,{className:"animate-spin text-gray-500",size:32}),e.jsx("p",{className:"ml-2 text-gray-500",children:"Loading Map..."})]}):e.jsx("div",{ref:c,className:"w-full h-64 rounded-lg shadow-md"})},le=({type:i})=>{const d={flatbed:"bg-blue-100 text-blue-800",wheel_lift:"bg-green-100 text-green-800",hook_and_chain:"bg-orange-100 text-orange-800"};return e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${d[i]||"bg-gray-100 text-gray-800"}`,children:i.replace("_"," ")})},me=({user:i,currentLang:d,activeRequest:a,setActiveRequest:f})=>{const n=H[d],{primaryColor:o,textColor:t}=R(),{notify:c}=K(),[m,g]=l.useState(10),[r,u]=l.useState(!1),[x,k]=l.useState("all"),[D,I]=l.useState("normal"),[re,$]=l.useState(null),[b,oe]=l.useState(G),[T,S]=l.useState(!1),[j,C]=l.useState(!0),[_,q]=l.useState([]);l.useEffect(()=>{C(!0);const s=B(E(w,"trucks")),h=F(s,y=>{const A=[];y.forEach(M=>{A.push({id:M.id,...M.data()})}),q(A),C(!1)});return()=>h()},[]),l.useEffect(()=>{if(a&&a.status===N.PENDING){const s=setTimeout(async()=>{if(a.id){const h=L(w,"assistanceRequests",a.id);await z(h,{status:N.ACCEPTED}),c(n.driverAcceptedTitle,{body:n.driverAcceptedBody})}},5e3);return()=>clearTimeout(s)}},[a,c,n]);const O=async()=>{S(!0);try{const s={userId:i.id,userLocation:new V(b.lat,b.lng),note:"",status:N.PENDING,createdAt:U()},h=await Y(E(w,"assistanceRequests"),s),y=await J(h);f({id:y.id,...y.data()}),c(n.requestCreatedTitle,{body:n.requestCreatedBody})}catch(s){console.error("Error creating request:",s)}finally{S(!1)}},P=async()=>{if(a&&a.id){const s=L(w,"assistanceRequests",a.id);await z(s,{status:N.CANCELLED}),f(null),$(null)}},p=_.filter(s=>x==="all"?!0:x==="online"?s.isAvailable:x==="offline"?!s.isAvailable:!0);return e.jsxs("div",{className:`pb-20 ${d==="ar"?"rtl":""}`,children:[e.jsxs("div",{className:"bg-white p-4 shadow-sm z-40 sticky top-16",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:`flex items-center space-x-2 text-sm text-${t}-600`,children:[e.jsx(ae,{size:16,className:`text-${o}-500`}),e.jsx("span",{children:"Constantine, Algeria"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{value:x,onChange:s=>k(s.target.value),className:`text-xs p-1.5 rounded-md border border-${t}-200 outline-none bg-white text-${t}-600`,children:[e.jsx("option",{value:"all",children:n.showAll||"All"}),e.jsx("option",{value:"online",children:n.showOnline||"Online"}),e.jsx("option",{value:"offline",children:n.showOffline||"Offline"})]}),e.jsx("button",{onClick:()=>u(!r),className:`p-1.5 rounded-md transition-colors ${r?`bg-${o}-100 text-${o}-600`:`bg-${t}-100 text-${t}-400`}`,title:"Toggle Traffic",children:e.jsx(Z,{size:16})})]})]}),!a&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`text-xs font-bold text-${t}-500`,children:["Radius: ",m,"km"]}),e.jsx("input",{type:"range",min:"5",max:"50",value:m,onChange:s=>g(Number(s.target.value)),className:`flex-1 h-2 bg-${t}-200 rounded-lg appearance-none cursor-pointer`})]})]}),e.jsxs("div",{className:"p-4 relative",children:[e.jsx(ne,{userLocation:b,trucks:p,onTruckClick:$,isLoading:j,primaryColor:o,mapStyle:D,onMapStyleChange:I}),r&&e.jsx("div",{className:"absolute top-6 right-6 bg-white/90 text-[10px] px-2 py-1 rounded shadow text-red-500 font-bold border border-red-200 z-30",children:"Heavy Traffic (N3)"})]}),e.jsx("div",{className:"px-4",children:a?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-yellow-500 p-4 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:`font-bold text-lg text-${t}-800`,children:[n.status,": ",a.status]}),e.jsxs("p",{className:`text-sm text-${t}-500`,children:["Request ID: #",a.id.substr(0,4)]})]}),e.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-bold animate-pulse",children:"Active"})]}),e.jsxs("p",{className:`text-${t}-600 text-sm mb-4`,children:[p.length," trucks notified in your area."]}),e.jsx("button",{onClick:P,className:`w-full bg-${t}-100 text-${t}-700 py-2 rounded-lg font-medium`,children:n.cancel})]}):e.jsx("button",{onClick:O,disabled:T||j,className:`w-full bg-red-600 text-white py-4 rounded-xl shadow-lg shadow-red-200 font-bold text-lg flex items-center justify-center space-x-2 transform transition active:scale-95 ${j?"opacity-50 cursor-not-allowed":""}`,children:T?e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:24}),e.jsx("span",{children:n.requestTow})]})})}),e.jsxs("div",{className:"mt-6 px-4",children:[e.jsxs("h3",{className:`font-bold text-${t}-700 mb-3`,children:[n.findingTrucks," (",p.length,")"]}),j?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsxs("div",{className:`bg-white p-4 rounded-lg shadow-sm border border-${t}-100 flex items-center space-x-3 animate-pulse`,children:[e.jsx("div",{className:`w-10 h-10 bg-${t}-200 rounded-full`}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:`h-4 bg-${t}-200 rounded w-1/3`}),e.jsx("div",{className:`h-3 bg-${t}-200 rounded w-1/4`})]})]},s))}):e.jsxs("div",{className:"space-y-3",children:[p.map(s=>e.jsxs("div",{className:`bg-white p-4 rounded-lg shadow-sm border border-${t}-100 flex items-center justify-between`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`bg-${o}-100 p-2 rounded-full text-${o}-600`,children:e.jsx(Truck,{size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-bold text-sm text-${t}-800`,children:s.companyName}),e.jsxs("p",{className:`text-xs text-${t}-500 flex items-center`,children:[e.jsx(le,{type:s.truckType}),e.jsx("span",{className:"mx-1",children:"â€¢"}),Math.abs(s.location.latitude-b.lat)*100<1?"0.5":"1.2"," ",n.distance]})]})]}),e.jsx("a",{href:`tel:${s.phone}`,className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 shadow-md shadow-green-200",children:e.jsx(W,{size:18})})]},s.id)),p.length===0&&e.jsx("div",{className:"text-center text-sm text-gray-500 py-4",children:"No trucks match your filter."})]})]})]})};export{me as default};
