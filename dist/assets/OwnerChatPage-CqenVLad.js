import{c as o,r as n,i as Q,u as W,q as O,w as q,a as k,o as I,k as X,j as e,T as Z,M as C,f as ee,b as $,s as se,C as L}from"./index-DB_CHirD.js";import{u as te}from"./useNotifications-DGZK_9WH.js";import{C as ae}from"./chevron-left-BKANMD17.js";import{C as le}from"./camera-DEf19reA.js";import{C as ne}from"./check-B4Q56XB-.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],re=o("bell-off",ie);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],R=o("bell",ce);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],P=o("check-check",oe);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xe=o("clock",de);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],he=o("ellipsis-vertical",me);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],fe=o("mic",ue);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],ge=o("paperclip",pe);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],be=o("send",ye);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M22 2 2 22",key:"y4kqgn"}]],ve=o("slash",je),Se=({user:m,currentLang:u})=>{const[l,M]=n.useState(null),[S,U]=n.useState([]),[v,z]=n.useState(""),[f,_]=n.useState([]),[g,T]=n.useState([]),[A,N]=n.useState(!1),[y,Ne]=n.useState(!1),[w,D]=n.useState(!1),[E,H]=n.useState([]),[K,B]=n.useState(!0);te();const b=Q.useRef(null),{primaryColor:d,textColor:x}=W(),c=Z[u];n.useEffect(()=>{B(!0);const s=O(k($,"users"),q("role","==","driver")),a=I(s,i=>{const r=[];i.forEach(t=>{t.id!==m.id&&r.push({id:t.id,...t.data()})}),H(r),B(!1)});return()=>a()},[m.id]);const G=()=>{b.current&&(b.current.scrollTop=b.current.scrollHeight)};n.useEffect(()=>{G()},[S,l,y]),n.useEffect(()=>{if(!l)return;const s=O(k($,"chats"),q("participants","array-contains",m.id),X("timestamp","asc")),a=I(s,i=>{const r=[];i.forEach(t=>{const j=t.data();(j.senderId===l||j.receiverId===l)&&r.push({id:t.id,...j})}),U(r)});return()=>a()},[l,m.id]);const h=async(s=v,a="text",i)=>{if(!s.trim()&&a==="text"||!l)return;const r={id:Date.now().toString(),senderId:m.id,receiverId:l,text:s,timestamp:Date.now(),status:"sent",type:a,locationData:i};z(""),D(!1),await ee(k($,"chats"),{...r,participants:[m.id,l],timestamp:se()})},V=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{const{latitude:a,longitude:i}=s.coords;h("Current Location","location",{lat:a,lng:i})},s=>{console.error("Geolocation error:",s),h("Constantine (Mock)","location",L)}):h("Constantine (Mock)","location",L)},Y=s=>{f.includes(s)?_(f.filter(a=>a!==s)):_([...f,s]),N(!1)},F=s=>{g.includes(s)?T(g.filter(a=>a!==s)):T([...g,s]),N(!1)},J=s=>s==="sending"?e.jsx(xe,{size:12,className:"text-gray-400"}):s==="sent"?e.jsx(ne,{size:12,className:"text-gray-400"}):s==="delivered"?e.jsx(P,{size:12,className:"text-gray-400"}):s==="read"?e.jsx(P,{size:12,className:"text-blue-500"}):null;if(l){const s=E.find(t=>t.id===l);if(!s)return null;const a=S,i=f.includes(l),r=g.includes(l);return e.jsxs("div",{className:`flex flex-col h-[calc(100vh-140px)] bg-${x}-50 ${u==="ar"?"rtl":""}`,children:[e.jsxs("div",{className:"bg-white p-3 shadow-sm flex justify-between items-center z-20",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>M(null),className:"mr-2",children:e.jsx(ae,{size:24,className:`text-${x}-600 ${u==="ar"?"rotate-180":""}`})}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative mr-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-${d}-100 flex items-center justify-center text-${d}-600 font-bold`,children:s.companyName.substring(0,1)}),s.isAvailable&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold text-sm text-${x}-800`,children:s.companyName}),e.jsx("span",{className:`text-[10px] ${y?"text-green-600 font-bold animate-pulse":"text-gray-400"}`,children:y?c.typing:s.isAvailable?c.online:c.offlineStatus})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>N(!A),className:`p-2 rounded-full hover:bg-gray-100 text-${x}-500`,children:e.jsx(he,{size:20})}),A&&e.jsxs("div",{className:`absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden z-50 ${u==="ar"?"left-0 right-auto":""}`,children:[e.jsxs("button",{onClick:()=>F(l),className:"w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center space-x-2 text-sm",children:[r?e.jsx(R,{size:16}):e.jsx(re,{size:16}),e.jsx("span",{children:r?c.unmuteChat:c.muteChat})]}),e.jsxs("button",{onClick:()=>Y(l),className:"w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center space-x-2 text-sm text-red-600",children:[e.jsx(ve,{size:16}),e.jsx("span",{children:i?c.unblockUser:c.blockUser})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",ref:b,children:[e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"bg-gray-200 text-gray-600 text-[10px] px-3 py-1 rounded-full",children:c.today||"Today"})}),a.map((t,j)=>{const p=t.senderId===m.id;return e.jsx("div",{className:`flex ${p?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[75%] group relative ${p?"items-end":"items-start"} flex flex-col`,children:e.jsxs("div",{className:`p-3 rounded-2xl text-sm shadow-sm relative ${p?`bg-${d}-600 text-white rounded-br-none`:"bg-white text-gray-800 rounded-bl-none"}`,children:[t.type==="location"?e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{size:16}),e.jsx("span",{className:"font-bold underline",children:"Location Shared"})]}),e.jsx("div",{className:"w-32 h-20 bg-gray-200 rounded overflow-hidden relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-300",children:e.jsx(C,{size:12,className:"text-gray-500"})})})]}):t.text,e.jsxs("div",{className:`text-[9px] mt-1 flex items-center justify-end space-x-1 ${p?"text-white/70":"text-gray-400"}`,children:[e.jsx("span",{children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),p&&J(t.status)]})]})})},t.id)}),y&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-white px-4 py-3 rounded-2xl rounded-bl-none shadow-sm flex space-x-1 items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})}),i&&e.jsx("div",{className:"text-center text-xs text-red-500 bg-red-50 py-2 rounded mt-4",children:"You have blocked this user."})]}),!i&&e.jsxs("div",{className:"bg-white p-2 border-t border-gray-100 pb-[env(safe-area-inset-bottom)] z-20",children:[w&&e.jsxs("div",{className:"flex space-x-4 p-3 bg-gray-50 rounded-lg mb-2 mx-2 animate-fade-in-up",children:[e.jsxs("button",{onClick:V,className:"flex flex-col items-center space-y-1 text-gray-600 hover:text-green-600",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full text-green-600",children:e.jsx(C,{size:20})}),e.jsx("span",{className:"text-[10px]",children:"Location"})]}),e.jsxs("button",{className:"flex flex-col items-center space-y-1 text-gray-600 hover:text-blue-600",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full text-blue-600",children:e.jsx(le,{size:20})}),e.jsx("span",{className:"text-[10px]",children:"Camera"})]})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("button",{onClick:()=>D(!w),className:`p-3 rounded-full hover:bg-gray-100 text-gray-500 transition-colors ${w?"bg-gray-200":""}`,children:e.jsx(ge,{size:20})}),e.jsx("div",{className:"flex-1 bg-gray-100 rounded-2xl px-4 py-2 flex items-center",children:e.jsx("textarea",{value:v,onChange:t=>z(t.target.value),placeholder:c.typeMessage,className:"w-full bg-transparent outline-none text-sm resize-none max-h-24 py-1",rows:1,onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),h())}})}),v.trim()?e.jsx("button",{onClick:()=>h(),className:`bg-${d}-600 text-white p-3 rounded-full hover:bg-${d}-700 shadow-md transition-all transform hover:scale-105 active:scale-95`,children:e.jsx(be,{size:18})}):e.jsx("button",{className:"bg-gray-200 text-gray-500 p-3 rounded-full hover:bg-gray-300",children:e.jsx(fe,{size:18})})]}),e.jsx("div",{className:"flex space-x-2 mt-2 overflow-x-auto pb-1 px-1 scrollbar-hide",children:["I'm arriving","Send location","Ok","Call me"].map(t=>e.jsx("button",{onClick:()=>h(t),className:"whitespace-nowrap px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs hover:bg-gray-200 border border-gray-200",children:t},t))})]})]})}return e.jsxs("div",{className:`p-4 pb-20 ${u==="ar"?"rtl":""}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:`font-bold text-lg text-${x}-800`,children:c.contacts}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{className:"p-2 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200",children:e.jsx(R,{size:18})})})]}),K?e.jsx("div",{className:"text-center text-sm text-gray-500 py-8",children:"Loading contacts..."}):e.jsx("div",{className:"space-y-3",children:E.map(s=>{const a=f.includes(s.id);return e.jsxs("button",{onClick:()=>M(s.id),className:`w-full bg-white p-4 rounded-xl shadow-sm border border-${x}-100 flex items-center justify-between hover:bg-gray-50 transition-colors ${a?"opacity-50 grayscale":""}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 overflow-hidden",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:`w-12 h-12 bg-${d}-100 rounded-full flex items-center justify-center text-${d}-600 font-bold text-lg`,children:s.companyName.substring(0,1)}),s.isAvailable&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"text-left min-w-0",children:[e.jsx("div",{className:"flex justify-between items-center w-full",children:e.jsx("h4",{className:`font-bold text-sm text-${x}-800 truncate pr-2`,children:s.companyName})}),e.jsx("p",{className:`text-xs text-${x}-500 truncate`,children:a?"(Blocked)":"Hey, are you available?"})]})]}),e.jsxs("div",{className:"flex flex-col items-end pl-2",children:[e.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap mb-1",children:"10:30 AM"}),s.id==="o2"&&e.jsx("span",{className:`w-5 h-5 bg-${d}-600 text-white text-[10px] rounded-full flex items-center justify-center`,children:"2"})]})]},s.id)})})]})};export{Se as default};
